#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if any UI component files are staged
STAGED_UI=$(git diff --cached --name-only --diff-filter=ACM | grep "^src/components/ui/.*\.tsx$" || true)

if [ -n "$STAGED_UI" ]; then
  echo "üîç Checking UI components for forwardRef usage..."
  
  node scripts/check-forward-ref.js
  
  if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå forwardRef check failed. Please update components to use React.forwardRef."
    echo ""
    exit 1
  fi
  
  echo "‚úÖ forwardRef checks passed"
else
  echo "‚è≠Ô∏è  No UI component files modified, skipping forwardRef checks"
fi

# Check if any locale files are staged
STAGED_LOCALES=$(git diff --cached --name-only --diff-filter=ACM | grep "^public/locales/.*\.json$" || true)

if [ -n "$STAGED_LOCALES" ]; then
  echo "üîç Running translation checks on modified locale files..."
  
  # Run with --fix to auto-add missing keys as placeholders
  node scripts/check-language.js --fix
  
  if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå Translation check failed. Please fix the issues above before committing."
    echo ""
    exit 1
  fi
  
  # Re-stage any auto-fixed locale files
  if [ -n "$(git diff --name-only public/locales/)" ]; then
    echo "üìù Auto-fixed locale files detected, staging changes..."
    git add public/locales/
  fi
  
  echo "‚úÖ Translation checks passed"
else
  echo "‚è≠Ô∏è  No locale files modified, skipping translation checks"
fi