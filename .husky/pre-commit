#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if any locale files are staged
STAGED_LOCALES=$(git diff --cached --name-only --diff-filter=ACM | grep "^public/locales/.*\.json$" || true)

if [ -n "$STAGED_LOCALES" ]; then
  echo "üîç Running translation checks on modified locale files..."
  
  # Run with --fix to auto-add missing keys as placeholders
  node scripts/check-language.js --fix
  
  if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå Translation check failed. Please fix the issues above before committing."
    echo ""
    exit 1
  fi
  
  # Re-stage any auto-fixed locale files
  if [ -n "$(git diff --name-only public/locales/)" ]; then
    echo "üìù Auto-fixed locale files detected, staging changes..."
    git add public/locales/
  fi
  
  echo "‚úÖ Translation checks passed"
else
  echo "‚è≠Ô∏è  No locale files modified, skipping translation checks"
fi